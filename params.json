{"name":"Trabajo-rmi","tagline":"Trabajo para la asignatura Sistemas Distribuidos y Servicios Web de 4º de GITT de la Universidad de Sevilla.","body":"#Simulación de Sistema Domótico\r\n\r\n## Introducción\r\nA continuación exponemos el funcionamiento de un simulador de un sistema de domótica diseñado para la asignatura Sistemas Distribuidos y Servicios Web.\r\n\r\nEl sistema se componen de varios dispositivos que se comunican entre ellos usando RMI (Remote Method Invocation). En nuestro ejemplo, los sitemas finales también se comunican por puerto serie con un microcontrolador que permite ver de forma más visual el control de los dispositivos.\r\n\r\nVamos a ver cada componente del sistema y describir su funcionamiento.\r\n\r\n## Servidor\r\n\r\nEn primer lugar tenemos nuestro servidor RMI. Su labor es registrar los diferentes dispositivos que pueden ser controlados, en nuestro caso vamos a usar una bombilla y una alarma, y ofrecer unos servicios a los controladores para que puedan interactuar con dichos dispositivos.\r\n\r\nEl servidor usa dos hilos sincronizados para levantar dos servicios diferentes, uno en `//ip:54321/Controller` y otro en `//ip:54321/Controllable`. De esta forma podemos atender simultáneamente a dispositivos controladores y controlables.\r\n\r\nEl servidor tiene una lista de los dispositivos controlables conectados en cada momento y que pueden solicitar en cualquier momento los dispositivos controladores.\r\n\r\nComo hay dos tipos de dispositivos se implementan dos servicio:\r\n\r\n- `ControllableService`: Para dispositivos que serán controlados.\r\n```java\r\npublic interface ControllableService extends Remote {\r\n\tpublic void addDevice(Device device) throws RemoteException;\r\n\tpublic void removeDevice(Device device) throws RemoteException;\r\n}\r\n```\r\n- `ControllerService`: Para controladores.\r\n```java\r\npublic interface ControllerService extends Remote {\r\n\tpublic List<Device> getControllableDevices() throws RemoteException;\r\n}\r\n```\r\n\r\n## Dispositivos controlables\r\n\r\nComo hemos visto anteriormente, tenemos dos tipos de dispositivos. Vamos a ver los dispositivos controlables.\r\n\r\nEste tipo de dispositivos no envían información al servidor. Cuando se instancian se conectarán al servidor y se darán de alta en él añadíendose a la lista de dispositivos conectados. Al terminarse la ejecución del código de estos dispositivos serán dados de baja del servidor. Podemos tener tantos dispositivos como queramos.\r\n\r\nEn nuestro ejemplo hemos definido dos tipos de dispositivos controlables, se podrían haber definido muchos más, pero para una demostración será suficiente.\r\n\r\n### Light\r\n\r\nEl dispositivo controlable `LightImpl` es el más simple. Representa una bombilla que puede estar apagada, encendida o, en genera, tomar un valor entre 0 y 255 que representará la intensidad. Implementa la interfaz `Light`.\r\n```java\r\npublic interface Light extends Device {\r\n\tvoid setIntensity(int intensity) throws RemoteException;\r\n\tvoid turnOn() throws RemoteException;\r\n\tvoid turnOff() throws RemoteException;\r\n\tvoid toggle() throws RemoteException;\r\n}\r\n```\r\nComo vemos, la interfaz `Light` a su vez hereda de la interfaz `Device`. Todos los dispositivos heredan de esta interfaz.\r\n\r\n### AlarmImpl\r\n\r\nNuesto segundo dispositivo de ejemplo es un poco más complejo. Se trata de una alarma que puede tomar el valor 0 o cualquier valor mayor que 1. Cuando se instancia, al igual que todos los dispositivos controlables, se conecta al servidor y se da de alta en la lista de dipositivos conectados. \r\nCuando la alarma es activada, empieza a imprimir por pantalla cada dos segundos la palabra \"ALARMA\", hasta que es desactivada. A continuacion vemos la intefaz implementada por `AlarmaImpl`:\r\n```java\r\npublic interface Alarm extends Device {\r\n\tpublic void start() throws RemoteException;\r\n\tpublic void stop() throws RemoteException;\r\n}\r\n```\r\n\r\n## Dispositivos controladores\r\n\r\nEstos dispositivos no reciben información, sólo envian órdenes. Cuando quieran realizar una acción se conectarán al servidor, obtendrán una lista de los dispositivos conectados y buscarán aquel con el que quieran interactuar. Vamos a ver los dos que hemos definido.\r\n\r\n### Switch\r\n\r\nBásicamente es un interruptor. Su tarea es buscar las bombillas conectadas y ejecutar alguna acción sobre ellas, gracias a que conoce la interfaz que implementa la bombilla.\r\n\r\nLos dispositivos controladores no necesitan darse de alta en ningún momento ni implementar ninguna interfaz. Su funcionamiento es parecido al de un cliente simple.\r\n\r\n### Accelerometer\r\n\r\nRepresenta un acelerómetro que al detectar un movimiento activaría la alarma. El funcionamiento es análogo al del switch. Este dispositivo esta siendo ejecutado monitorizando un evento y al producirse lanzará una conexión al servidor activando las alarmas que estén en ese momento conectadas al servidor.\r\n\r\nTampoco se da de alta en el servidor, sólo lanza una petición al ocurrir el evento.\r\n\r\n## Monitor\r\nA parte de haber definido los dos tipos de dispositivos y el servidor también tenemos un `Monitor`. Dicho monitor nos permitiría comprobar el funcionamiento de los dispositivos ya que nos permite controlarlos a todos, por ejemplo, apagando y encendiendo alarmas  o luces.\r\n\r\nTambién se podría configurar para recibir eventos y mostrarlos por pantallas. Sería como una mezcla de los dos tipos de dispositivos en uno, para monitorizar lo que está ocurriendo.\r\n\r\n## Apéndice: Comunicaciones serie\r\nPara ilustrar de forma más visual nuestro trabajo hemos usado microcontroladores que se comunican por puerto serie con los dispositivos finales a fin de que parezca un sistema más \"real\".\r\n\r\nEn nuestro ejemplo hemos usado un Arduino que se conecta por puerto serie con el objeto `AlarmaImpl`. Este objeto implementa unas librerías de comunicación serie con el Arduino y cuando la alarma es activada envía un comando y el Arduino hace parpadear un led rojo y emite un pitido.\r\n\r\nDurante la presentacion del trabajo intentaremos poder realizar un ejemplo completo con un acelerómetro conectado a un equipo que haga sonar la alarma en otro equipo de forma remota.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}